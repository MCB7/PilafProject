<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
    <script>
        let app;
        let body;
        let pimg;
        let eyelid;
        let eyelidSheet = {};
        let pb;
        let Psheet = {};
        let bg0;
        let bg1;
        let bg2;
        let bg3;
        let bg4;
        let bg5;
        let bg6;
        let bg7;

        let bgX = 0;
        let bgSpeed = 1;







    


        window.onload = function() {
            app = new PIXI.Application({
                width: 1242,
                height: 603,
                backgroundColor: 0xFFFFFF
            });
            
            var renderer = PIXI.autoDetectRenderer({
                width: 1242,
                height: 603,
                
                transparent: true
               
            });


            var renderer1 = PIXI.autoDetectRenderer({
                width: 1242,
                height: 603,
                transparent: true
                
                
               
            });

            var renderer2 = PIXI.autoDetectRenderer({
                width: 1242,
                height: 603,
                transparent: true


                
                
                
               
            });

            var rendererL = PIXI.autoDetectRenderer({
              width: 1242,
              height: 603,
              transparent: true


            })


            var rendererB = PIXI.autoDetectRenderer({
              width: 1242,
              height: 603,
              transparent: true


            })

            
            var stage2 = new PIXI.Container();
            var stage1 = new PIXI.Container();
            var stage = new PIXI.Container();
            var stageL = new PIXI.Container();
            var stageB = new PIXI.Container();

            var LidContainer = new PIXI.Container();
            stageL.addChild(LidContainer);

            var pupilContainer = new PIXI.Container();
            stage1.addChild(pupilContainer);

            var BContainer = new PIXI.Container();
            stageB.addChild(BContainer);
            

         
            function createP(){
          pimg = new PIXI.Sprite.from("pupil1.png");
          pimg.anchor.set(.5, 0.9);
          pimg.position.x = 890;
          pimg.position.y = 300;
          pupilContainer.addChild(pimg);
            }
        

         
        function CreateMB() {   
        img = new PIXI.Sprite.from("MB1.png");
        
        img.width.x = 1242;
        img.height.y = 603;
        img.anchor.set(.5, 0.9);
        img.position.x = 750;
        img.position.y = 570;
        
        
        stage.addChild(img);

        depthMap = new PIXI.Sprite.from("BW.png");

        depthMap.width.x = 1242;
        depthMap.height.y = 603;
        depthMap.anchor.set(.5, 0.9);
        depthMap.position.x = 750;
        depthMap.position.y = 570;

        stage.addChild(depthMap);
        }

        function Dis(){
        displacementFilter = new PIXI.filters.DisplacementFilter(depthMap);
        stage.filters = [displacementFilter];

        window.onmousemove = function(e) {
        displacementFilter.scale.x = (window.innerWidth / 7 - e.clientX) /70;
        displacementFilter.scale.y = (window.innerHeight / 6 - e.clientY) /60;
        }
          };


         

      
        function rotateToPoint(mx, my, px, py){  
          var self = this;
          var dist_Y = my - py;
          var dist_X = mx - px;
          var angle = Math.atan2(dist_Y,dist_X);
          var degrees = angle * 360/ Math.PI;
          return angle;
            }


            function createEyelidSheet() {
         let  ssheet = new PIXI.BaseTexture.from("eyelid_spritesheet.png");
         let w = 1229;
         let h = 691;
            
         eyelidSheet["blink"] = [
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            new PIXI.Texture( ssheet, new PIXI.Rectangle()),
            
            new PIXI.Texture( ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(0 * w, 0, w, h)),
           
            new PIXI.Texture( ssheet, new PIXI.Rectangle(1 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(1 * w, 0, w, h)),
           
            new PIXI.Texture( ssheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(3 * w, 0, w, h)),
           
            new PIXI.Texture( ssheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(4 * w, 0, w, h)),
           
            new PIXI.Texture( ssheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            new PIXI.Texture( ssheet, new PIXI.Rectangle(5 * w, 0, w, h)),
            
            new PIXI.Texture( ssheet, new PIXI.Rectangle(5 * w, 0, w, h))
        ];

        } 

        function createEyelid() {
         eyelid = new PIXI.AnimatedSprite(eyelidSheet.blink);
         eyelid.anchor.set(0.5);
         eyelid.animationspeed = .5;
         eyelid.loop = true;
         eyelid.x = 670;
         eyelid.y = 355; 
         stageL.addChild(eyelid);
         eyelid.play();

        return eyelid;
        }

        

        function createPBsheet() {
         let  Buttonsheet = new PIXI.BaseTexture.from("purplebutton_spritemap.png");
         let w = 490;
         let h = 450;
            
         Psheet["blink1"] = [

       


           
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(1 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(1 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(1 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(1 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(1 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(1 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(1 * w, 0, w, h)),

            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(2 * w, 0, w, h)),
            

            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(3 * w, 0, w, h)),
            
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(4 * w, 0, w, h)),
            new PIXI.Texture( Buttonsheet, new PIXI.Rectangle(4 * w, 0, w, h)),

        

            
        
           
           
        ];

        } 

        function createPB() {
         pb = new PIXI.AnimatedSprite(Psheet.blink1);
         pb.anchor.set(0.5);
         pb.animationspeed = 1.75;
         pb.loop = true;
         pb.x = 300;
         pb.y = 355; 
         stageB.addChild(pb);
         pb.play();

        return pb;
        }


           
        function animateP() {  
        requestAnimationFrame(animateP);
    
        // just for fun, let's rotate mr rabbit a little
        pimg.position.x = 900;
        pimg.position.y = 290;
      
        pimg.rotation = rotateToPoint(renderer1.plugins.interaction.mouse.global.x, renderer1.plugins.interaction.mouse.global.y, pimg.position.x, pimg.position.y);
        
        }
    
        // render the container
     







          CreateMB();
          
          Dis();
          createP();
          animateP();  
          
          
          createEyelidSheet();
          createEyelid();

          createPBsheet();
          createPB();

      
         
         
         
         
         
  

          
          
          

          

           
    
          
          
      
            
        

            
       
       
     
       



       
        
    
    /*////////////////////////////////////////*/
    
    var snakeContainer = new PIXI.Container();
    snakeContainer.scale.set( renderer.width / renderer.height  );
    snakeContainer.position.x = (renderer.width/2) + 80;
    snakeContainer.position.y = renderer.height/2;
    stage2.addChild(snakeContainer);
    
    /*////////////////////////////////////////*/
    
    // build a rope!
    var pointCount = 20;
    var ropeLength = 800 / pointCount;
    var points = [];
    
    for (var i = 0; i < pointCount; i++) {
      //let ease = easein( i / pointCount );
      let point = new PIXI.Point( i * ropeLength, 0)
      points.push(point);
    }
    
    var loader = new PIXI.Loader();
    loader.add('worm','tentacle.png');
    loader.add('MB1', 'MB1.png');
   

   

    function onAssetsLoaded(loader, sprites){
      var strip = new PIXI.SimpleRope(sprites.worm.texture, points);
      

     

      
     
      strip.x = -400;
      strip.angle = 10;
     
    
      

      
      snakeContainer.addChild(strip);
      
      
    }
    
    loader.once('complete', onAssetsLoaded);
    loader.load();
    
    
    /*////////////////////////////////////////*/
    
    var offsetX = 0.5,
        _offsetX = 0.5,
        offsetY = 0.5,
        _offsetY = 0.5,
        mouseX = 0, mouseY = 0;
    
    stage.interactive = true;
    stage.on('mousemove',function(e){ 
      mouseY = e.data.originalEvent.clientY;
      mouseX = e.data.originalEvent.clientX;
    });
    
    /*////////////////////////////////////////*/
    
    var count = 0;
    
    function ease(current,target,ease){ 
      return current + (target - current) * ( ease || 0.2 );
    }
    
    function animate() {
      requestAnimationFrame(animate);
    
      count += 0.02;
    
      offsetY = mouseY / renderer.height;
      offsetX = mouseX / renderer.width;
      
      _offsetY = ease(_offsetY, offsetY, 0.02);
      _offsetX = ease(_offsetX, offsetX, 0.03);
      
    
      for (var i = 0; i < points.length; i++) {
        
        //points[i].y = ease( points[i].y, (mouseY/i) + (renderer.height/2), 0.1 / (i+1));
        //points[i].x = ease( points[i].x, (mouseX) + ((i+2) * ropeLength), 0.1 / (i+1));// + (i * ropeLength);
        
        
        points[i].__y = ( points[i].__y !== undefined ? points[i].__y : points[i].y );
        points[i].y = (renderer.height/2) * (Math.sin(( _offsetY - 0.5)) * ((pointCount - i) * 0.1));
        points[i].y += (Math.sin((i * 0.25) + count) * 20);
    
        points[i].__x = ( points[i].__x !== undefined ? points[i].__x : points[i].x );
        points[i].x = points[i].__x + ((renderer.width/2) * (( _offsetX - 0.15) * ((pointCount - i) * 0.1)));
        points[i].x += (Math.sin((i * 0.5) + count) * 10);
    
        //points[i].x += Math.cos((i * 0.2) + count) * 5;
      }
      
      renderer.render(stage);
       renderer1.render(stage1);
       rendererL.render(stageL);
       renderer2.render(stage2);
       rendererB.render(stageB);
      
      
      
    }
    animate();

            
            
            document.body.appendChild(renderer.view);

            document.body.appendChild(renderer1.view);

            document.body.appendChild(rendererL.view)

            document.body.appendChild(renderer2.view)

            document.body.appendChild(rendererB.view)

            

            

            renderer.view.style.position = 'absolute';renderer.view.style.left = '50%';
            renderer.view.style.top = '50%';
            renderer.view.style.transform = 'translate3d( -50%, -50%, 0 )';

            renderer1.view.style.position = 'absolute';renderer1.view.style.left = '50%';
            renderer1.view.style.top = '50%';
            renderer1.view.style.transform = 'translate3d( -50%, -50%, 0 )';

            renderer2.view.style.position = 'absolute';renderer2.view.style.left = '50%';
            renderer2.view.style.top = '50%';
            renderer2.view.style.transform = 'translate3d( -50%, -50%, 0 )';

            rendererL.view.style.position = 'absolute';rendererL.view.style.left = '50%';
            rendererL.view.style.top = '50%';
            rendererL.view.style.transform = 'translate3d( -50%, -50%, 0 )';

            app.view.style.position = 'absolute';app.view.style.left = '50%';
            app.view.style.top = '50%';
            app.view.style.transform = 'translate3d( -50%, -50%, 0 )';

            rendererB.view.style.position = 'absolute';rendererB.view.style.left = '50%';
            rendererB.view.style.top = '50%';
            rendererB.view.style.transform = 'translate3d( -50%, -50%, 0 )';






            document.querySelector("#gameDiv").appendChild(app.view);

            

           
        
           
             app.loader
            
             .add("bg7", "08_eggplant.png")
             .add("bg6", "07_magenta.png")
             .add("bg5", "06_orange.png")
             .add("bg4", "05_gold.png")
             .add("bg3", "04_lime.png")
             .add("bg2", "03_kelly.png")
             .add("bg1", "02_turquoise.png")
             .add("bg0", "01_cobalt.png")
                
             
                
                
                
                
                
                
             app.loader.onComplete.add(initLevel);
             app.loader.load();
        
    }

    function gameLoop(delta) {
        updateBg();
        

    }

    function initLevel() {
        bg3 = createBg(app.loader.resources["bg3"].texture);
        bg6 = createBg(app.loader.resources["bg6"].texture);
        bg4 = createBg(app.loader.resources["bg4"].texture);
        bg5 = createBg(app.loader.resources["bg5"].texture);
        bg7 = createBg(app.loader.resources["bg7"].texture);
        bg0 = createBg(app.loader.resources["bg0"].texture);
        bg1 = createBg(app.loader.resources["bg1"].texture);
        bg2 = createBg(app.loader.resources["bg2"].texture);
        app.ticker.add(gameLoop);
    }


      
 


        function createBg(texture) {
            let tiling = new PIXI.TilingSprite(texture, 124200, 603);
            tiling.position.set(0,0);
            app.stage.addChild(tiling);

            return tiling;
        }

        function updateBg() {
            bgX = (bgX + bgSpeed);
            
            bg0.tilePosition.x = bgX * .75 ; 
            bg1.tilePosition.x = bgX * 1.70;
            bg2.tilePosition.x = bgX * 1.10;
            bg3.tilePosition.x = bgX * 1.59;
            bg4.tilePosition.x = bgX * 1.90;
            bg5.tilePosition.x = bgX * 1.30;
            bg6.tilePosition.x = bgX * 1.45;
            bg7.tilePosition.x = bgX * 1.33;
        }
        
            
    
        </script>



</head>
<body>
 <div id="gameDiv"> </div>   
</body>
</html>